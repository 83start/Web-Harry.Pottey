!function($){"use strict";$.fn.midnight=function(customOptions){return"object"!=typeof customOptions&&(customOptions={}),this.each((function(){var settings={headerClass:"midnightHeader",innerClass:"midnightInner",defaultClass:"default",classPrefix:""};$.extend(settings,customOptions);var scrollTop=window.pageYOffset||document.documentElement.scrollTop,documentHeight=$(document).height(),$originalHeader=$(this),headers={},headerInfo={top:0,height:$originalHeader.outerHeight()},$sections=$("[data-midnight]"),sections=[],getSupportedTransform,transformMode=function(){for(var prefixes=["transform","WebkitTransform","MozTransform","OTransform","msTransform"],ix=0;ix<prefixes.length;ix++)if(void 0!==document.createElement("div").style[prefixes[ix]])return prefixes[ix];return!1}();if(0!=$sections.length){var getContainerHeight=function(){var $customHeaders=$originalHeader.find("> ."+settings.headerClass),maxHeight=0,height=0;return $customHeaders.length?$customHeaders.each((function(){var $header=$(this),$inner=$header.find("> ."+settings.innerClass);$inner.length?($inner.css("bottom","auto"),height=$inner.outerHeight(),$inner.css("bottom","0")):($header.css("bottom","auto"),height=$header.outerHeight(),$header.css("bottom","0")),maxHeight=height>maxHeight?height:maxHeight})):maxHeight=height=$originalHeader.outerHeight(),maxHeight},updateHeaderHeight=function(){headerInfo.height=getContainerHeight(),$originalHeader.css("height",headerInfo.height+"px")},setupHeaders;(function(){headers.default={},$sections.each((function(){var $section,headerClass=$(this).data("midnight");"string"==typeof headerClass&&""!==(headerClass=headerClass.trim())&&(headers[headerClass]={})}));var defaultPaddings_top=$originalHeader.css("padding-top"),defaultPaddings_right=$originalHeader.css("padding-right"),defaultPaddings_bottom=$originalHeader.css("padding-bottom"),defaultPaddings_left=$originalHeader.css("padding-left"),$customHeaders;$originalHeader.css({position:"fixed",top:0,left:0,right:0,overflow:"hidden"}),updateHeaderHeight(),($customHeaders=$originalHeader.find("> ."+settings.headerClass)).length?$customHeaders.filter("."+settings.defaultClass).length||$customHeaders.filter("."+settings.headerClass+":first").clone(!0,!0).attr("class",settings.headerClass+" "+settings.defaultClass):$originalHeader.wrapInner('<div class="'+settings.headerClass+" "+settings.defaultClass+'"></div>');var $customHeaders,$defaultHeader=($customHeaders=$originalHeader.find("> ."+settings.headerClass)).filter("."+settings.defaultClass).clone(!0,!0);for(var headerClass in headers)if(headers.hasOwnProperty(headerClass)&&void 0===headers[headerClass].element){var $existingHeader=$customHeaders.filter("."+headerClass);$existingHeader.length?headers[headerClass].element=$existingHeader:headers[headerClass].element=$defaultHeader.clone(!0,!0).removeClass(settings.defaultClass).addClass(headerClass).appendTo($originalHeader);var resetStyles={position:"absolute",overflow:"hidden",top:0,left:0,right:0,bottom:0};headers[headerClass].element.css(resetStyles),!1!==transformMode&&headers[headerClass].element.css(transformMode,"translateZ(0)"),headers[headerClass].element.find("> ."+settings.innerClass).length||headers[headerClass].element.wrapInner('<div class="'+settings.innerClass+'"></div>'),headers[headerClass].inner=headers[headerClass].element.find("> ."+settings.innerClass),headers[headerClass].inner.css(resetStyles),!1!==transformMode&&headers[headerClass].inner.css(transformMode,"translateZ(0)"),headers[headerClass].from="",headers[headerClass].progress=0}$customHeaders.each((function(){var $header=$(this),hasAnyClass=!1;for(var headerClass in headers)headers.hasOwnProperty(headerClass)&&$header.hasClass(headerClass)&&(hasAnyClass=!0);$header.find("> ."+settings.innerClass).length||$header.wrapInner('<div class="'+settings.innerClass+'"></div>'),hasAnyClass||$header.hide()}))})();var recalculateSections=function(){documentHeight=$(document).height(),sections=[];for(var ix=0;ix<$sections.length;ix++){var $section=$($sections[ix]);sections.push({element:$section,className:$section.data("midnight"),start:$section.offset().top,end:$section.offset().top+$section.outerHeight()})}};setInterval(recalculateSections,1e3);var recalculateHeaders=function(){scrollTop=window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop,scrollTop=Math.max(scrollTop,0),scrollTop=Math.min(scrollTop,documentHeight);var headerHeight=headerInfo.height,headerStart=scrollTop+headerInfo.top,headerEnd=scrollTop+headerInfo.top+headerHeight;for(var headerClass in headers)headers.hasOwnProperty(headerClass)&&(headers[headerClass].from="",headers[headerClass].progress=0);for(var ix=0;ix<sections.length;ix++)headerEnd>=sections[ix].start&&headerStart<=sections[ix].end&&(headers[sections[ix].className].visible=!0,headerStart>=sections[ix].start&&headerEnd<=sections[ix].end?(headers[sections[ix].className].from="top",headers[sections[ix].className].progress+=1):headerEnd>sections[ix].end&&headerStart<sections[ix].end?(headers[sections[ix].className].from="top",headers[sections[ix].className].progress=1-(headerEnd-sections[ix].end)/headerHeight):headerEnd>sections[ix].start&&headerStart<sections[ix].start&&("top"===headers[sections[ix].className].from?headers[sections[ix].className].progress+=(headerEnd-sections[ix].start)/headerHeight:(headers[sections[ix].className].from="bottom",headers[sections[ix].className].progress=(headerEnd-sections[ix].start)/headerHeight)))},updateHeaders=function(){var totalProgress=0,lastActiveClass="";for(var headerClass in headers)headers.hasOwnProperty(headerClass)&&""!==!headers[headerClass].from&&(totalProgress+=headers[headerClass].progress,lastActiveClass=headerClass);for(var ix in totalProgress<1&&(""===headers[settings.defaultClass].from?(headers[settings.defaultClass].from="top"===headers[lastActiveClass].from?"bottom":"top",headers[settings.defaultClass].progress=1-totalProgress):headers[settings.defaultClass].progress+=1-totalProgress),headers)if(headers.hasOwnProperty(ix)&&""!==!headers[ix].from){var offset=100*(1-headers[ix].progress);"top"===headers[ix].from?!1!==transformMode?(headers[ix].element[0].style[transformMode]="translateY(-"+offset+"%) translateZ(0)",headers[ix].inner[0].style[transformMode]="translateY(+"+offset+"%) translateZ(0)"):(headers[ix].element[0].style.top="-"+offset+"%",headers[ix].inner[0].style.top="+"+offset+"%"):!1!==transformMode?(headers[ix].element[0].style[transformMode]="translateY(+"+offset+"%) translateZ(0)",headers[ix].inner[0].style[transformMode]="translateY(-"+offset+"%) translateZ(0)"):(headers[ix].element.style.top="+"+offset+"%",headers[ix].inner.style.top="-"+offset+"%")}};$(window).resize((function(){recalculateSections(),updateHeaderHeight(),recalculateHeaders(),updateHeaders()})).trigger("resize");var requestAnimationFrame=window.requestAnimationFrame||window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(callback){window.setTimeout(callback,1e3/60)},updateHeadersLoop=function(){requestAnimationFrame(updateHeadersLoop),recalculateHeaders(),updateHeaders()};updateHeadersLoop()}}))}}(jQuery);